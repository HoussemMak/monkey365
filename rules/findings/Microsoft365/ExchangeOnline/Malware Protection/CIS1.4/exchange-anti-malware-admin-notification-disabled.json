{
    "serviceType":  "Exchange Online",
    "serviceName":  "Microsoft 365",
    "displayName":  "Ensure notifications for internal users sending malware is Enabled For Administrators",
    "description":  "Consider to setup the Exchange Online Protection malware filter to notify administrators if internal senders are blocked for sending malware.",
    "rationale":  "This setting alerts administrators that an internal user sent a message that contained malware. This may indicate an account or machine compromise, that would need to be investigated.",
    "impact":  "Notification of account with potential issues should not cause an impact to the user.",
    "remediation":  '
					###### To enable notifications for internal users sending malware, use the Microsoft 365 Admin Center
					1. Select Security.
					2. Expand `Threat Management`then select `Policy`.
					3. Select `Anti-Malware`.
					4. Change the setting `Notify administrator about undelivered messages from internal senders` to `Always On` and enter the email address of the administrator who should be notified under `Administrator email address`.
					###### To check the setting from PowerShell, use the Exchange Online Module for PowerShell
					1. Connect to Exchange Online using `Connect-ExchangeOnline`
					2. Run the following PowerShell command:					
					```powershell
					set-MalwareFilterPolicy -Identity \'{Identity Name}\' -EnableInternalSenderAdminNotifications $True -InternalSenderAdminAddress {admin@domain1.com}
					```
	',
    "references":  [
                       "https://docs.microsoft.com/en-us/office365/servicedescriptions/exchange-online-protection-service-description/anti-spam-and-anti-malware-protection-eop"
	],
    "compliance":  [
		{
			"name":  "CIS Microsoft 365 Foundations",
			"version":  "1.4.0",
			"reference":  "4.11"
		}
	],
	"level": "medium",
    "tags":  null,
    "path":  "o365_exo_malware_policy",
    "conditions":  [
		{
			operator:  'and',
			statements:  [
				{
					conditions:  [
						["isEnabled","eq","True"]
					]
				},
				{
					conditions:  [
						["Policy.EnableInternalSenderAdminNotifications","eq","false"],
						["Policy.InternalSenderAdminAddress.Length","eq","0"]
					],
					operator:  'or'
				}				
			]
		}
	],
    "idSuffix":  "o365_exo_anti_malware_admin_notification_disabled"
}
