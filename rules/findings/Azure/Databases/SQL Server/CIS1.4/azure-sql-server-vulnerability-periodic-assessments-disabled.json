{
  "args": [
    
  ],
  "provider": "Azure",
  "serviceType": "SQL Server",
  "serviceName": "Databases",
  "displayName": "Ensure that VA setting Periodic Recurring Scans is enabled on a SQL server",
  "description": "Enable Vulnerability Assessment (VA) Periodic recurring scans for critical SQL servers and corresponding SQL databases.",
  "rationale": "VA setting \u0027Periodic recurring scans\u0027 schedules periodic (weekly) vulnerability scanning for the SQL server and corresponding Databases. Periodic and regular vulnerability scanning provides risk visibility based on updated known vulnerability signatures and best practices.",
  "impact": "Enabling the **Microsoft Defender for Cloud** for SQL features will incur additional costs for each SQL server.",
  "remediation": {
    "text": "###### From Azure Console\r\n\t\t\t\t\t1. Go to `SQL servers`.\r\n\t\t\t\t\t2. Select a server instance\r\n\t\t\t\t\t3. Click on `Microsoft Defender for Cloud`\r\n\t\t\t\t\t4. Ensure that `Microsoft Defender for Cloud for SQL` is set to `Enabled`\r\n\t\t\t\t\t5. In Section `Vulnerability Assessment Settings`, Ensure Storage Accounts is configured.\r\n\t\t\t\t\t6. In Section `Vulnerability Assessment Settings`, Ensure Periodic recurring scans is set to `On`",
    "code": {
      "powerShell": null,
      "iac": null,
      "terraform": null,
      "other": null
    }
  },
  "recommendation": null,
  "references": [
    "https://docs.microsoft.com/en-us/azure/sql-database/sql-vulnerability-assessment",
    "https://docs.microsoft.com/en-us/rest/api/sql/servervulnerabilityassessments/listbyserver",
    "https://docs.microsoft.com/en-in/powershell/module/Az.Sql/Update-AzSqlServerVulnerabilityAssessmentSetting?view=azps-2.6.0",
    "https://docs.microsoft.com/en-in/powershell/module/Az.Sql/Get-AzSqlServerVulnerabilityAssessmentSetting?view=azps-2.6.0",
    "https://docs.microsoft.com/en-us/azure/security/benchmarks/security-controls-v2-posture-vulnerability-management#pv-6-perform-software-vulnerability-assessment"
  ],
  "compliance": [
    {
      "name": "CIS Microsoft Azure Foundations",
      "version": "1.4.0",
      "reference": "4.2.3"
    }
  ],
  "level": "medium",
  "tags": [
    
  ],
  "rule": {
    "path": "az_sql_servers",
    "subPath": null,
    "selectCondition": {
      
    },
    "query": [
      {
        "filter": [
          {
            "conditions": [
              [
                "vaConfig.properties.recurringScans.isEnabled",
                "eq",
                "False"
              ]
            ]
          }
        ]
      }
    ],
    "shouldExist": null,
    "returnObject": null,
    "removeIfNotExists": null
  },
  "output": {
    "html": {
      "data": {
        "properties": {
          "name": "Server Name",
          "location": "Location",
          "resourceGroupName": "Resource group name",
          "fqdn": "FQDN",
          "vaConfig.properties.recurringScans.isEnabled": "Recurring Scans"
        },
        "expandObject": null
      },
      "table": "Normal",
      "decorate": [
        
      ],
      "emphasis": [
        
      ],
      "actions": {
        "objectData": {
          "expand": [
            "name",
            "location",
            "resourceGroupName",
            "fqdn",
            "vaConfig"
          ],
          "limit": null
        },
        "showGoToButton": "True",
        "showModalButton": "True"
      }
    },
    "text": {
      "data": {
        "properties": {
          
        },
        "expandObject": null
      },
      "status": {
        "keyName": [
          
        ],
        "message": "",
        "defaultMessage": null
      },
      "properties": {
        "resourceName": null,
        "resourceId": null,
        "resourceType": null
      },
      "onlyStatus": false
    }
  },
  "idSuffix": "sql_server_va_periodic_disabled",
  "notes": [
    
  ],
  "categories": [
    
  ]
}
