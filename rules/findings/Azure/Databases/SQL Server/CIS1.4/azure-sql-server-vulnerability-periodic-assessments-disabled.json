{
  "serviceType": "SQL Server",
  "serviceName": "Databases",
  "displayName": "Ensure that VA setting Periodic Recurring Scans is enabled on a SQL server",
  "description": "Enable Vulnerability Assessment (VA) Periodic recurring scans for critical SQL servers and corresponding SQL databases.",
  "rationale": "VA setting 'Periodic recurring scans' schedules periodic (weekly) vulnerability scanning for the SQL server and corresponding Databases. Periodic and regular vulnerability scanning provides risk visibility based on updated known vulnerability signatures and best practices.",
  "impact": "Enabling the **Microsoft Defender for Cloud** for SQL features will incur additional costs for each SQL server.",
  "remediation": "\r\n\t\t\t\t\t###### From Azure Console\r\n\t\t\t\t\t1. Go to `SQL servers`.\r\n\t\t\t\t\t2. Select a server instance\r\n\t\t\t\t\t3. Click on `Microsoft Defender for Cloud`\r\n\t\t\t\t\t4. Ensure that `Microsoft Defender for Cloud for SQL` is set to `Enabled`\r\n\t\t\t\t\t5. In Section `Vulnerability Assessment Settings`, Ensure Storage Accounts is configured.\r\n\t\t\t\t\t6. In Section `Vulnerability Assessment Settings`, Ensure Periodic recurring scans is set to `On`\r\n\t",
  "references": [
    "https://docs.microsoft.com/en-us/azure/sql-database/sql-vulnerability-assessment",
    "https://docs.microsoft.com/en-us/rest/api/sql/servervulnerabilityassessments/listbyserver",
    "https://docs.microsoft.com/en-in/powershell/module/Az.Sql/Update-AzSqlServerVulnerabilityAssessmentSetting?view=azps-2.6.0",
    "https://docs.microsoft.com/en-in/powershell/module/Az.Sql/Get-AzSqlServerVulnerabilityAssessmentSetting?view=azps-2.6.0",
    "https://docs.microsoft.com/en-us/azure/security/benchmarks/security-controls-v2-posture-vulnerability-management#pv-6-perform-software-vulnerability-assessment"
  ],
  "compliance": [
    {
      "name": "CIS Microsoft Azure Foundations",
      "version": "1.4.0",
      "reference": "4.2.3"
    }
  ],
  "level": "medium",
  "tags": null,
  "path": "az_sql_servers",
  "conditions": [
    {
      "statements": [
        {
          "conditions": [
            [
              "vaConfig.properties.recurringScans.isEnabled",
              "eq",
              "False"
            ]
          ]
        }
      ]
    }
  ],
  "idSuffix": "sql_server_va_periodic_disabled",
  "status": {
    "keyName": [],
    "message": ""
  },
  "notes": [],
  "categories": [],
  "fields": {
    "resourceName": null,
    "resourceId": null,
    "resourceType": null
  }
}
