{
    "serviceType":  "General",
    "serviceName":  "Microsoft Entra ID",
    "displayName":  "Ensure That 'Users Can Consent to Apps Accessing Company Data on Their Behalf Is Set To 'Allow for Verified Publishers'",
    "description":  "Allow users to provide consent for selected permissions when a request is coming from a verified publisher.",
    "rationale":  "Unless Microsoft Entra ID is running as an identity provider for third-party applications, do not allow users to use their identity outside of the cloud environment. User profiles contain private information such as phone numbers and email addresses which could then be sold off to other third parties without requiring any further consent from the user.",
    "impact":  "Enforcing this setting may create additional requests that administrators need to fulfill quite often.",
    "remediation":  "
						###### From Azure Console
						1. Go to `Microsoft Entra ID`
						2. Go to `Users`
						3. Go to `User settings`
						4. Click on `Manage how end users launch and view their applications`
						5. Click on `Consent and Permissions`
						6. Set ` Allow user consent for apps from verified publishers, for selected permissions`
						7. Click on `Save`
	",
    "references":  [
		"https://docs.microsoft.com/en-us/azure/active-directory/manage-apps/methods-for-assigning-users-and-groups",
		"https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-how-applications-are-added",
		"https://ezcloudinfo.com/2019/01/22/configure-access-panel-in-azure-active-directory/",
		"https://blogs.msdn.microsoft.com/exchangedev/2014/06/05/managing-user-consent-for-applications-using-office-365-apis/",
		"https://nicksnettravels.builttoroam.com/post/2017/01/24/Admin-Consent-for-Permissions-in-Azure-Active-Directory.aspx",
		"https://docs.microsoft.com/en-us/azure/active-directory/manage-apps/configure-user-consent#configure-user-consent-to-applications",
		"https://docs.microsoft.com/en-us/azure/security/benchmarks/security-controls-v2-privileged-access#pa-1-protect-and-limit-highly-privileged-users",
		"https://docs.microsoft.com/en-us/azure/security/benchmarks/security-controls-v2-privileged-access#pa-2-restrict-administrative-access-to-business-critical-systems",
		"https://docs.microsoft.com/en-us/azure/security/benchmarks/security-controls-v2-governance-strategy#gs-2-define-enterprise-segmentation-strategy",
		"https://docs.microsoft.com/en-us/azure/security/benchmarks/security-controls-v2-governance-strategy#gs-6-define-identity-and-privileged-access-strategy"
	],
    "compliance":  [
		{
			"name":  "CIS Microsoft Azure Foundations",
			"version":  "1.5.0",
			"reference":  "1.11"
		}
	],
	"level": "medium",
    "tags":  null,
    "path":  "aad_authorization_policy",
    "conditions":  [
		{
			statements:  [
				{
					conditions:  [
						["TenantAuthPolicy.defaultUserRolePermissions.permissionGrantPoliciesAssigned.Count","ne","0"],
						["TenantAuthPolicy.defaultUserRolePermissions.permissionGrantPoliciesAssigned","eq","ManagePermissionGrantsForSelf.microsoft-user-default-legacy"]
					],
					operator:  "and"
				}
			]
		}
	],
    "idSuffix":  "aad_require_trusted_publisher_apps"
}
